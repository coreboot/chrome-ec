/* Copyright 2022 The ChromiumOS Authors
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

/* Rex program common DTSI includes */
#include "../fan.dtsi"
#include "../generated.dtsi"
#include "../interrupts.dtsi"
#include "../keyboard.dtsi"
#include "../power_signals.dtsi"
#include "../rex.dtsi"
#include "../temp_sensors.dtsi"
#include "../usbc.dtsi"

/* Karis project DTS includes */
#include "battery.dtsi"
#include "cbi.dtsi"
#include "i2c.dtsi"
#include "led_pins.dtsi"
#include "led_policy.dtsi"
#include "motionsense.dtsi"

/ {
	named-gpios {
		/delete-node/ ec_spare_gpio42;
		/delete-node/ ec_spare_gpioc7;
		/delete-node/ ec_spare_gpioa4;
		/delete-node/ usb_c1_rst_odl;
		/delete-node/ usb_c0_rt_rst_ls_l;
		/delete-node/ led_3_l;
		/delete-node/ led_4_l;
		/delete-node/ usb_c0_sbu_fault_odl;
		/delete-node/ usb_c0_bc12_int_odl;
		/delete-node/ usb_c1_bc12_int_odl;

		gpio_usb_c0_frs_en: usb_c0_frs_en {
			gpios = <&gpio4 2 GPIO_OUTPUT_LOW>;
		};
		gpio_usb_c0_rt_rst_odl: usb_c0_rt_rst_odl {
			gpios = <&gpio3 7 GPIO_OUTPUT>;
		};
		/*
		 * Karis moves usb_c1_rst_odl form GPIO37 to GPIOC7
		 * and rename to usb_c1_rt_3p3_sx_en
		 */
		gpio_usb_c1_rst_odl: usb_c1_rt_3p3_sx_en {
			gpios = <&gpioc 7 GPIO_ODR_LOW>;
		};
		/*
		 * Karis moves usb_c1_rt_rst_r_odl form GPIO72 to
		 * GPIOA4 for the RST PIN should be 1.8V
		 */
		gpio_usb_c1_rt_rst_r_odl: usb_c1_rt_rst_r_odl {
			gpios = <&gpioa 4 GPIO_ODR_HIGH>;
		};
		gpio_ec_spare_gpio74: gpio_ec_spare_gpio74 {
			gpios = <&gpio7 4 GPIO_OUTPUT>;
		};
	};

	unused-pins {
		compatible = "unused-gpios";
		unused-gpios =
			<&gpioc 2 0>, /* led_3_l */
			<&gpio6 0 0>; /* led_4_l */
	};

	aliases {
		hbr-usb-c1-rt-pwr-en = &gpio_usb_c1_rst_odl;
		hbr-usb-c1-rt-int-odl = &gpio_usb_c1_rt_int_odl;
		hbr-usb-c1-rt-rst-odl = &gpio_usb_c1_rt_rst_r_odl;
		syv-usb-c1-frs-en = &gpio_usb_c1_frs_en;
	};

	gpio-interrupts {
		/delete-node/ ec_accel;
		/delete-node/ ec_als_rgb;
		/delete-node/ c0_sbu_fault;
		/delete-node/ usb_c0_bc12;
		/delete-node/ usb_c1_bc12;

		int_imu: ec_imu {
			irq-pin = <&gpio_ec_imu_int_r_l>;
			flags = <GPIO_INT_EDGE_FALLING>;
			handler = "bma4xx_interrupt";
		};
	};
};

&i2c1_0 {
	/delete-node/ nct38xx@70;

	tcpc_rt1716_port0: rt1716@4e {
		compatible = "richtek,rt1715-tcpc";
		reg = <0x4e>;
		tcpc-flags = <(TCPC_FLAGS_TCPCI_REV2_0 |
			TCPC_FLAGS_TCPCI_REV2_0_NO_VSAFE0V)>;
		/* a duplicate of the <&gpio_usb_c0_tcpc_int_odl> node in
		 * "named-gpios". This is the Zephyr preferred style,
		 * the "named-gpios" node will be dealt with at a later date.
		 */
		irq-gpios = <&gpioe 0 GPIO_ACTIVE_LOW>;
		is-alt;
	};
};

&ppc_port0_syv {
	frs_en_gpio = <&gpio_usb_c0_frs_en>;
};

&i2c2_0 {
	/delete-node/ pi3usb9201@5f;
};

&i2c3_0 {
	usb_c1_hb_retimer: jhl9040r-c1@55 {
		compatible = "intel,jhl9040r";
		reg = <0x55>;
		ls-en-pin = <&gpio_usb_c1_rst_odl>; /* usb_c1_rt_3p3_sx_en */
		int-pin = <&gpio_usb_c1_rt_int_odl>;
		reset-pin = <&gpio_usb_c1_rt_rst_r_odl>;
	};
};

&usb_c0_hb_retimer {
	reset-pin = <&gpio_usb_c0_rt_rst_odl>;
};

&i2c6_1 {
	/delete-node/ pi3usb9201@5f;
	/delete-node/ usb-c1-hb-retimer@56;
};

&usbc_port0 {
	/delete-property/ bc12;

	tcpc = <&tcpc_rt1716_port0>;
};

&usbc_port1 {
	/delete-property/ bc12;
};
